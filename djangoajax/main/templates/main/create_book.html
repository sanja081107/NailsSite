{% extends 'main/base.html' %}

{% block body %}


<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div>{{ form.non_field_errors }}</div>  <!-- Выдается общая ошибка по всем полям если форма не связана с моделью -->

    <div class="add-post">
        {% for el in form %}
            <p><label>{{ el.label }}:</label> {{ el }}</p>
            <div class="form-error">{{ el.errors }}</div>   <!-- Выдается ошибка по отдельному полю формы -->
        {% endfor %}
    </div>
        <button class="btn btn-danger" type="submit">Создать</button>
</form><br><br>

{% if posts %}
    <p>Созданные записи: </p>
    {% for el in posts %}
        <p>{{ el.title }}&nbsp;&nbsp;
            {% if el.is_active %}
                {% if not el.client %}
                    <a class="btn btn-sm btn-outline-success" href="{% url 'not_active' el.pk %}"><i class="fa-solid fa-check"></i></a>
                {% else %}
                    <button class="btn btn-sm btn-outline-success" onclick="CancelBook({{ el.id }})"><i class="fa-solid fa-check"></i></button>
                {% endif %}
            {% else %}
                <a class="btn btn-sm btn-outline-danger" href="{% url 'is_active' el.pk %}"><i class="fa-solid fa-xmark"></i></a>
            {% endif %}&nbsp;&nbsp;

            <a href="{% url 'edit_book' el.pk %}"><i class="fa-solid fa-gear"></i></a>
            {% if el.client %}
                {{ el.client.first_name }} {{ el.client.last_name }}
                <br><br><button class="btn btn-primary" onclick="CancelBook({{ el.id }})">Отменить запись</button>
                <div class="post" id="post-{{ el.id }}"></div>
            {% endif %}
            <br>
            -----------------------------------------
        </p>
    {% endfor %}
{% endif %}

<script type="text/javascript">

function CancelBook(id) {

    var post = document.getElementById("post-"+id+"");
    $(".post").empty();

    var yes = document.createElement("a");
    var no = document.createElement("button");
    var quest = document.createElement("label");

    yes.innerHTML = "Да";
    yes.className = "btn delete-book-btn btn-outline-danger";
    yes.href = "/not_active_"+id+""

    no.innerHTML = "Нет";
    no.className = "btn delete-book-btn btn-outline-success";
    no.addEventListener("click", NoCancelBook, false);

    quest.innerHTML = "Вы уверены?&nbsp;&nbsp;";

    post.append(quest, yes, no);

<!--    alert("Вы уверены что хотите удалить запись: "+id)-->

};

function NoCancelBook() {

    $(".post").empty();

};

</script>

{% endblock %}
